<!-- TOC -->

- [1. FAQ](#1-faq)
  - [1.1. 点了某个按钮后，页面没有任何反应](#11-点了某个按钮后页面没有任何反应)
  - [1.2. 为什么我的页面没有wellClient的全局变量](#12-为什么我的页面没有wellclient的全局变量)
  - [1.3. 为什么我在电脑上登录了wellPhone，但是页面软电话登录的时候，还是报错说分机未注册](#13-为什么我在电脑上登录了wellphone但是页面软电话登录的时候还是报错说分机未注册)
  - [1.4. 页面刷新或者关闭后，软电话（即指wellClient）是否会自动登出？](#14-页面刷新或者关闭后软电话即指wellclient是否会自动登出)
  - [1.5. 如果断网了，软电话是否会自动登出？](#15-如果断网了软电话是否会自动登出)
  - [1.6. 软电话使用了websocket，如果因为网络不稳定，websocket断开后，是否会自动重连。](#16-软电话使用了websocket如果因为网络不稳定websocket断开后是否会自动重连)
  - [1.7. 软电话对浏览器有什么要求，IE浏览器支持到什么版本？](#17-软电话对浏览器有什么要求ie浏览器支持到什么版本)
  - [1.8. 直接转分机的号码形式](#18-直接转分机的号码形式)
  - [1.9. 我的浏览器支持websocket, 为什么无法建立websocekt连接](#19-我的浏览器支持websocket-为什么无法建立websocekt连接)
  - [1.10. 从日志看收到了某个事件，但是页面没有变化。例如收到接通事件，页面按钮都没变](#110-从日志看收到了某个事件但是页面没有变化例如收到接通事件页面按钮都没变)
  - [1.11. 如何下载日志？](#111-如何下载日志)
  - [1.12. 呼出就秒挂](#112-呼出就秒挂)
  - [1.13. 外线挂断后，软电话收不到挂断事件，软电话主动挂断却可以收到挂断事件](#113-外线挂断后软电话收不到挂断事件软电话主动挂断却可以收到挂断事件)

<!-- /TOC -->

# 1. FAQ

## 1.1. 点了某个按钮后，页面没有任何反应

页面上的每一按钮其实对应一个HTTP请求，例如一个挂断按钮，其实对应一个挂断的http请求。点击任何一个可点击的按钮，都会触发一个请求。
例如你点击了挂断请求，按理说会发送挂断的请求，但是有时候点击了挂断按钮，但是页面也没有任何反应，这是候应该按照以下思路去排查。

- 1. 问题能否可重现：如果问题只是偶然出现一次，有可能是环境的问题，有可能的网络的问题。

- 2. 检查HTTP请求：如果请求都没有发送，那么页面是不会有任何变化的。这时候要检查前端js的逻辑，打开控制台看看有没有报错信息。 如果请求发送了，但是状态码在400以上，这说明请求发送了。但是请求出错了。这时候要看看请求的状态码

- 3. 检查有没有收到事件： 如果请求发送了，状态码是200或者204，这说明请求成功了，但是请求成功了，页面并不会有任何变化。因为页面的变化是由事件驱动的。例如你发送一个登录请求，请求也成功了，但是页面没有任何变化。这只能说明没有收到登录成功事件。同理，如果你点击了挂断，但是页面没有任何变化，这可能是你没有收到挂断事件。请记住，页面的变化是由事件驱动的。

[⬆ 回到顶部](#1-faq)

## 1.2. 为什么我的页面没有wellClient的全局变量
首先，先判断你有没有引入well-client.js，如果这个文件没有引入，那么自然是没有wellClient的全局变量。

其次，你有没有使用iframe的方式引入软电话的所有文件，如果是以iframe的方式引入的，那么wellClient的变量在当前页面是无法获取的，因为这是跨iframe。变量是无法互相通信的，除非借助特殊的方法。（关于跨iframe通信，可以自行google一下）

[⬆ 回到顶部](#1-faq)

## 1.3. 为什么我在电脑上登录了wellPhone，但是页面软电话登录的时候，还是报错说分机未注册
首先，请确保wellPhone是正常在线状态。
其他，wellPhone的状态和服务端的状态可能存在状态延迟，就是说虽然你的wellPhone是在线的，可能服务端还没有刷新它的状态。你可以稍等片刻，再次尝试登录。

[⬆ 回到顶部](#1-faq)

## 1.4. 页面刷新或者关闭后，软电话（即指wellClient）是否会自动登出？
wellClient注册了windows.onunload事件，页面关闭或者刷新的时候，会自动登出。

[⬆ 回到顶部](#1-faq)

## 1.5. 如果断网了，软电话是否会自动登出？
软电话每隔2分钟会向服务端发送一次心跳请求，如果服务端在3分钟之内没有收到座席的心跳，会强制将座席登出。

[⬆ 回到顶部](#1-faq)

## 1.6. 软电话使用了websocket，如果因为网络不稳定，websocket断开后，是否会自动重连。
软电话会自动重连，最多重连5次，每隔1秒钟去重连1次。如果5次都重连失败，那么会发送wsDisconnected事件，调用wsDisconnect的事件处理函数。

[⬆ 回到顶部](#1-faq)

## 1.7. 软电话对浏览器有什么要求，IE浏览器支持到什么版本？
wellClient支持大部分现代浏览器，目前暂时支持IE11。IE8暂时不支持。
其他不支持websocket的浏览器，前端可以使用ajax等其他方式来模拟websocket，但是这需要后端也要支持。

![](http://p3alsaatj.bkt.clouddn.com/20180518093526_xqJTtA_Jietu20180518-093514.jpeg)

[⬆ 回到顶部](#1-faq)

## 1.8. 直接转分机的号码形式

```
总机号-[W|w]分机号
```
规则说明：

符号 | 是否必须 | 描述
---|---|---
'-' | 是 | 转接分机符号，总机号和分机号之间有且仅有一个英文短横"-"
W | 否 | W代表1s后转分机，WW代表两秒后转分机
w | 否 | w代表0.5秒转分机，ww代表1秒后转分机
Ww都没有 | 否 | Ww符号都没有，表示接通总机后直接转分机，不做等待

示例：

```
<option value="">转接到</option>
<option value="938834600-WW8001">先拨打38834600，等待2s后转8001分机</option>
<option value="938834600-Ww8002">先拨打38834600，等待1.5s后转8001分机</option>
```

[⬆ 回到顶部](#1-faq)

## 1.9. 我的浏览器支持websocket, 为什么无法建立websocekt连接

- 如果你电脑开了vpn, 请关闭vpn后，再试试websocket能否建立连接。
- 如果还是不能建立连接，可以打开控制台，将错误信息截图发给我，或者复制信息后发给我

[⬆ 回到顶部](#1-faq)

## 1.10. 从日志看收到了某个事件，但是页面没有变化。例如收到接通事件，页面按钮都没变

收到事件后，页面没有变化，有以下可能原因
1. 事件的callId和之前的事件的callId不一致
2. 事件重复，一个事件发过来多次
3. 事件的顺序混乱。一般来说打电话时，第一个收到的事件应该是serviceIniriated，如果这个事件在最后在发过来。
这样肯定会出现问题。

[⬆ 回到顶部](#1-faq)

## 1.11. 如何下载日志？
```
// 打开控制台输入
wellClient.downloadLog();
```

[⬆ 回到顶部](#1-faq)

## 1.12. 呼出就秒挂
引起问题往往是外呼号码不正常，或者中继问题。排查问题思路。

1. 呼出的号码没有加前缀：有时候号码需要加上出局号才能外呼，所以首先先询问运营商，检查是否需要加出局号码
2. 外呼的号码本身就不是正常的号码
3. makeCall请求originForDisplay字段不符合中继设置

建议直接使用分机拨号试试，而不是从软电话拨号，看看能否呼出。

[⬆ 回到顶部](#1-faq)


## 1.13. 外线挂断后，软电话收不到挂断事件，软电话主动挂断却可以收到挂断事件

这种情况一般是中继没有将挂断信号送到CES, 需要检查中继是否正常

[⬆ 回到顶部](#1-faq)